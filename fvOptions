/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \      /  F ield          | OpenFOAM: The Open Source CFD Toolbox           |
|  \    /   O peration      | Version:  v2012 or later                        |
|   \  /    A nd            | Web:      www.OpenFOAM.com                      |
|    \/     M anipulation   |                                                 |
\*---------------------------------------------------------------------------*/

NMSI_forcing
{
    type codedSource;
    active true;

    selectionMode all;
    fields (h);

    codeInclude
    #{
        #include "fvCFD.H"
    #};

    codeOptions
    #{
        -I$(LIB_SRC)/finiteVolume/lnInclude
        -I$(LIB_SRC)/meshTools/lnInclude
    #};

    codeCorrect
    #{
    #};

    codeAddSup
    #{
        const Time& time = mesh().time();
        scalar t = time.value();

        scalar A_pi = 0.35;
        scalar w_pi = 1.2;
        scalar beta_e = 0.03;

        // Oscillatory forcing term
        scalar piStar = A_pi * sin(w_pi*t);
        scalar eStar = exp(-beta_e*t);

        // Apply forcing uniformly for demonstration
        forAll(h, celli)
        {
            Su[celli] += rho[celli]*Cp[celli]*piStar*eStar;
        }
    #};

    codeSetValue
    #{
    #};
}
